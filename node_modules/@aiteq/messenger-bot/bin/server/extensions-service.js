"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logger_1 = require("../logger");
const router_service_1 = require("./router-service");
class ExtensionsService extends router_service_1.RouterService {
    addExtension(extension) {
        const view = extension.getView();
        logger_1.default.info("adding extension", view);
        this.get(`/${view}`, (req, res, next) => {
            logger_1.default.debug(`received request for EXTENSION '${view}':`, req.query);
            const ref = ExtensionsService.RE_DOMAIN.exec(req.headers.referer);
            ref && res.header("X-Frame-Options", `ALLOW-FROM https://www${ref[0]}`);
            res.header("Content-Security-Policy", "frame-ancestors 'self' https://*.messenger.com/ https://*.facebook.com/");
            res.render(view, extension.getModel());
        });
        return this;
    }
}
ExtensionsService.RE_DOMAIN = /\.(messenger|facebook)\.com\/?/;
exports.ExtensionsService = ExtensionsService;
