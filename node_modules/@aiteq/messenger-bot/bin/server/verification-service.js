"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logger_1 = require("../logger");
const router_service_1 = require("./router-service");
class VerificationService extends router_service_1.RouterService {
    constructor(verifyToken) {
        super();
        this.verifyToken = verifyToken;
        this.get("/", (req, res, next) => {
            logger_1.default.info("webhook verification request received:", req.query);
            if (req.query["hub.mode"] === "subscribe") {
                if (req.query["hub.verify_token"] === verifyToken) {
                    logger_1.default.info("webhook is verified with token:", verifyToken);
                    res.status(200).send(req.query["hub.challenge"]);
                    return;
                }
                else {
                    logger_1.default.warn("not verified - wrong verification token");
                    res.status(403).end();
                    return;
                }
            }
            else {
                logger_1.default.error("unknown request (hub.mode != 'subscribe')");
            }
            logger_1.default.debug("returning 400 Bad Request");
            res.status(400).end();
        });
    }
}
exports.VerificationService = VerificationService;
